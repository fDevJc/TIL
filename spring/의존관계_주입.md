# 의존관계주입

- 다양한 의존관계 주입 방법
    - 생성자 주입
    - 수정자 주입(setter 주입)
    - 필드 주입
    - 일반 메서드 주입
- 생성자 주입
    - 생성자를 통해 의존 관계를 주입 받는 방법
    - 특징
        - 생성자 호출시점 딱 1번만 호출되는 것을 보장
        - 불변, 필수 의존관계에 사용
        - final 을 선언 함으로써 필수라고 인식 → 불변
        - 생성자에 값을 넣지 않을경우 컴파일에러 → 필수
        - 생성자 주입은 빈등록과 의존관계주입이 동시에
- 👍  스프링빈 등록은 2가지 라이프 사이클
    1. 빈등록
    2. 의존관계 설정
- 👍  생성자가 하나일경우 @Autowired 생략가능
- 수정자 주입(setter 주입)
    - setter라 불리는 수정자 메서드를 이용한 방법
    - 선택, 변경 가능성이 있는 의존관계에 사용
    - 자바빈 프로퍼티 규약의 수정자 메서드 방식을 사용
    - @Autowired의 기본동작은 주입할 대상이 없으면 오류 발생
    주입할 대상이 없이 동작하도록 하려면 <br>
    @Autowired( required = false ) 로 지정
- 👍  생성자 주입, 세터 주입이 두 개 동시에 존재할경우 두개다 실행됨
- 필드 주입
    - 코드가 간결하지만 외부변경이 불가해 테스트하기 힘듬
    - DI컨테이너가 없다면 아무것도 할 수 없다
    - 특별한 용도 없이 사용하지말자
- 일반 메서드 주입
    - 일반적으로 잘 사용하지 않는다

- 옵션 처리
    - 주입할 스프링 빈이 없어도 동작해야 할 때가 있다
    - 자동 주입 대상을 옵션으로 처리하는 방법
        - @Autowired( required = false )
        : 수정자 메서드 자체가 호출 안됨
        - @Nullable
        : 자동 주입할 대상이 없으면 null
        - Optional<>
        : 자동 주입할 대상이 없으면 Optional.empty
        
- 생성자 주입을 선택하는 이유
    - 불변
        - 대부분 주입이 일어나면 종료시점까지 의존관계를 변경할 일이 없다.
        대부분 의존관계는 애플리케이션 종료전까지 변하면 안된다(불변)
        - 수정자 메서드를 이용하면 setXXX를 public으로 열어두어야한다.
    - 누락
        - 순수한 자바코드로 테스트를 진행시에 개발자의 실수로 누락될경우
        생성자 주입을 통한 의존관계주입은 컴파일단계에서 확인할 수 있다.<br>
        → 순수한 자바 언어의 특징을 살리는 방법
    - final 키워드
        - final키워드를 활용하면 생성자 생성시 혹시라도 값이 입력되지 않으면
        컴파일 단계에서 확인가능 하다.
        - 생성자 주입외의 다른 주입의 경우 생성자 이후에 호출 되므로
        final을 사용할 수 없다.
- @Autowired는 type으로 조회한다.
    - 2개 이상의 빈이 조회될경우
    **NoUniqueBeanDefinitionException** 에러 발생
    Bean이 유니크 하지 않다!
    - 해결방법
        - @Autowired 필드명으로 매칭 (파라미터명도 가능) <br>
        ex) private DiscountPolicy discountPolicy →
        private DiscountPolicy fixDiscountPolicy
        - @Qualifier(””) 애노테이션을 활용한 방법
        : 빈에 특정한 이름을 다시 준다
        - @Primary 애노테이션을 활용한 방법
        : 빈에 우선순위를 준다
- 조회한 빈을 모두 이용할때 Map, List를 이용할 수 있다.
