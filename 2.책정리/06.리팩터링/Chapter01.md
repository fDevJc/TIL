# 01 리팩터링: 첫 번째 예시

## 1.1 자, 시작해보자!

## 1.2 예시 프로그램을 본 소감
프로그램이 잘 작동하는 상황에서 그저 코드가 지저분하다는 이유로 불평하는 것은 프로그램의 구조를 너무 미적인 기준으로만 판단하는 건 아닐까?

컴파일러는 코드가 깔끔하든 지저분하든 개의치 않는다.

하지만 그 코드를 수정하려면 사람이 개입되고, 사람은 코드의 미적 상태에 민감하다. 설계가 나쁜 시스템은 수정하기 어렵다. 무엇을 수정할지 찾기 어렵다면 실수를 저질러서 버그가 생길 가능성도 높아진다.

> 프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 현태로 리팩터링하고 나서 원하는 기능을 추가한다.

새로운 기능을 추가할 때 로직을 변경할 일이 절대 없다면 복사 붙이는 방식도 상관없지만, 오래 사용할 프로그램이라면 중복 코드는 골칫거리가 된다.

`리팩터링이 필요한 이유는 바로 변경 때문` 잘 작동하고 나중에 변경할 일이 절대 없다면 코드를 현재 상태로 놔둬도 아무런 문제가 없다.

누군가 코드를 읽지 않는 한 아무런 피해가 없다. 하지만 다른 사람이 읽고 이해해야 할 일이 생겼는데 로직을 파악하기 어렵다면 대책을 마련해야 한다.

## 1.3 리팩터링의 첫 단계
리팩터링의 첫 단계는 코드 영역을 꼼꼼하게 검사해줄 `테스트 코드`들 부터 마련.

> 리팩터링하기 전에 제대로 된 테스트부터 마련한다. 테스트는 반드시 자가진단하도록 만든다


## 1.4 statement() 함수 쪼개기


코드 조각을 함수로 추출 `함수 추출하기(6.1절)`

리팩토링 후에는 컴파일하고 테스트해서 실수한게 없는지 확인한다.

> 리팩터링은 프로그램 수정을 작은 단계로 나눠 진행한다. 그래서 중간에 실수하더라도 버그를 쉽게 찾을 수 있다.

하나의 리팩터링을 문제없이 끝낼 떄마다 커밋한다. 그래야 중간에 문제가 생기더라도 이전의 정상 상태로 쉽게 돌아갈 수 있다. 이렇게 자잘한 변경들이 어느 정도 의미 있는 단위로 뭉쳐지면 공유 저장소로 푸시

함수를 추출하고 나면 추출된 함수 코드를 들여다보면서 명확하게 표현할 수 있는 방법이 있는지 고민(변수의 이름 등)

> 컴퓨터가 이해하는 코드는 바보도 작성할 수 있다. 사람이 이해하도록 작성하는 프로그래머가 진정한 실력자다.

좋은 코드라면 하는 일이 명확히 드러나야하며, 이때 변수 이름은 커다란 역할을 한다.

`임시 변수를 질의 함수로 바꾸기(7.4절)`

`변수 인라인하기(6.4절)` (🤔 음 이건 사실 좋은지 모르겠다. 변수를 인라인을 계속하게 되면 오히려 가독성이 떨어지는거 같기도하고..)

`함수 선언 바꾸기(6.5절)`

리팩터링과 성능의 관계, 느려지더라도 제대로 리팩터링된 코드베이스는 그렇지 않은 코드보다 성능을 개선하기가 훨씬 수월하다.

이름짓기는 중요하면서도 쉽지 않은 작업이다. (맞지)

`반복문 쪼개기(8.7절)`

`문장 슬라이드하기(8.6절)`

`함수로 추출(6.1절)`

반복문 쪼개기 -> 성능 저하? 미미할때가 많다

때로는 성능에 상당한 영향을 주기도한다. 저자는 개의치 않고 리팩터링을 한다. 그 후 성능개선 작업을 한다.

리팩터링 때문에 성능이 떨어진다면, 하던 리팩터링을 마무리하고 나서 성능을 개선하자.

## 1.5 중간 점검: 난무하는 중첩 함수

## 1.6 계산 단계와 포맷팅 단계 분리하기

리팩터링 초기 단계: 프로그램의 논리적인 요소를 파악하기 쉽도록 코드의 구조를 보강

복잡하게 얽힌 덩어리를 잘게 쪼개는 작업은 이름을 잘 짓는 일만큼 중요하다

`단계 쪼개기(6.11절)`

얕은 복사를 수행한 이유: 가변 데이터는 금방 상하기 때문에 데이터를 불변 취급

`함수 옮기기(8.1절)`

`반복문을 파이프라인으로 바꾸기(8.8절)`

## 1.7 중간점검: 두파일(과 두단계)로 분리됨

모듈화하면 각 부분이 하는 일과 그 부분들이 맞물려 돌아가는 과정을 파악하기 쉬워진다.

> 캠핑러에게는 "도착했을 때보다 깔끔하게 정돈하고 떠난다"는 규칙이 있다.
> 
> 프로그래밍도 마찬가지다. 항싱 코드를 작업 시작 전보다 건강하게 만들어놓고 떠나야 한다.

## 1.8 다형성을 활용해 계산 코드 재구성하기

`조건부 로직을 다형성으로 바꾸기(10.4절)`

`타입 코드를 서브클래스로 바꾸기(12.6절)`

`생성자를 팩터리 함수로 바꾸기(11.8절)`

## 1.9 상태점검: 다형성을 활용하여 데이터 생성하기

## 1.10 마치며
이번장의 리팩터링 세 단계

1. 원본 함수를 중첩 함수 여러 개로 나누기

2. 단계 조깨기를 적용해서 계산 코드와 출력 코드 분리

3. 계산 로직을 다형성으로 표현

> 좋은 코드를 가늠하는 확실한 방법은 '얼마나 수정하기 쉬운가'다

