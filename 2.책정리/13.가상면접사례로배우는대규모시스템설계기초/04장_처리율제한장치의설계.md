# 처리율 제한 장치의 설계
- Dos(Denial of Service) 공격에 의한 자원 고갈을 방지 할 수 있다
- 비용절감. 써드파티 API에 비용을 줄일 수 있다.
- 서버 과부하를 막는다
- 설계
    1. 문제 이해 및 설계 범위 확정
        - 클라이언트-서버 통신 모델
        - 어느 기준?
        - 시스템 규모?
        - 분산 환경?
        - 독립된 서비스?, 애플리케이션에 코드로?
        - 알림?
    2. 개략적 설계안 제시 및 동의 구하기
        - 클라이언트? 서버? 어디에 구현?
            - 클라이언트에 두는 것은 좋지 못함, 위변조 가능
            - 클 -> 서버(처리율 제한장치)
            - 클 -> 제한장치 -> 서버
                - API 게이트웨이
            - 서버에 두든, 미들웨어를 만들든 정답은 없음
        - 클라이언트와 서버사이에 미들웨어로 구현
        - 알고리즘은 선택
        - 카운터를 저장해야되는데 DB의 경우 느리기에 메모리에 저장 (Redis)
    3. 상세 설계

---
## 용어 정리
- API 게이트웨이
    - 처리율 제한, SSL 종단, 사용자 인증, IP허용 목록 관리 등
- 처리율 제한 알고리즘
    - 토큰 버킷
        - 지정된 용량의 토큰 버킷
        - 버킷으로 토큰 공급기가 특정시간 특정 토큰을 추가한다. 가득차있을경우 토큰은 버려진다
        - 사용자로부터 요청이 올경우 버킷에 토큰이 존재한다면 토큰을 꺼내고 요청을 처리한다
        - 토큰이 존재하지 않는 경우 요청은 버려진다
        - 사용 예
            - 사용자별 제한을 둔다면 사용자마다 버킷을 사용
            - IP 주소마다 제한을 둔다면 IP마다 버킷을 사용
            - 초당 제한을 둔다면 모든 요청이 하나의 버킷을 사용
    - 누출 버킷 알고리즘
        - FIFO
        - 요청과 서버사이에 요청큐를 두어 큐가 가득찰 경우 요청이 버려짐
        - 요청큐의 요청이 하나씩 처리됨
    - 고정 윈도 카운터 알고리즘
        - 특정기간동안 특정수의 윈도가 생성되고 윈도수만큼 요청을 처리, 윈도수 이상의 요청은 버려짐
    - 이동 윈도 로깅 알고리즘
        - 요청의 타임스탬프를 남긴다
        - 요청이 올경우 타임스탬프의 로그를 확인하여 특정기간내 로그의 수를 확인하여 요청을 처리할지 버릴지 결정
    - 이동 윈도 카운터 알고리즘
        - 음 이건 이해가 안되네
        - TCP에 윈도우 내용이랑 비슷한건가?
        - 나중에 다시 공부
    